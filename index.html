<!DOCTYPE html>
<html>
<head>
<title>Shopping List</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script type="text/javascript">
	var clientId = '858797607546-dp88c7nfffrbgqf9nl73tpcsu6erbsno.apps.googleusercontent.com';
	var spreadsheetId = '1ExPySGmKeU9pkXGoZfedwfJF4rtK5jJuOlxY1OGuYiY';
	var categoriesSheetName = 'Categories';
	var storesSheetName = 'Stores';
	var inventorySheetName = 'Inventory';
	var shoppingListSheetName = 'Shopping List';

	var categories = [];
	var stores = [];
	var inventoryList = [];
	var shoppingList = [];

	function handleClientLoad() {
		gapi.load('client:auth2', initClient);
	}

	function initClient() {
		gapi.client.init({
			clientId : clientId,
			scope : 'https://www.googleapis.com/auth/spreadsheets'
		}).then(function() {
			loadFromSheets();
			setupRealTimeUpdates();
		});
	}

	function loadFromSheets() {
		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : spreadsheetId,
			range : categoriesSheetName
		}).then(function(response) {
			var range = response.result;
			if (range.values.length > 0) {
				categories = range.values[0];
			}
			loadCategories();
		});

		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : spreadsheetId,
			range : storesSheetName
		}).then(function(response) {
			var range = response.result;
			if (range.values.length > 0) {
				stores = range.values[0];
			}
			loadStores();
		});

		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : spreadsheetId,
			range : inventorySheetName
		}).then(function(response) {
			var range = response.result;
			if (range.values.length > 0) {
				for (var i = 1; i < range.values.length; i++) {
					var row = range.values[i];
					var product = {
						name : row[0],
						quantity : row[1],
						price : row[2],
						category : row[3],
						store : row[4]
					};
					inventoryList.push(product);
				}
			}
			loadInventoryList();
		});

		gapi.client.sheets.spreadsheets.values.get({
			spreadsheetId : spreadsheetId,
			range : shoppingListSheetName
		}).then(function(response) {
			var range = response.result;
			if (range.values.length > 0) {
				for (var i = 1; i < range.values.length; i++) {
					var row = range.values[i];
					var product = {
						name : row[0],
						quantity : row[1],
						price : row[2],
						category : row[3],
						store : row[4]
					};
					shoppingList.push(product);
				}
			}
			loadShoppingList();
		});
	}

	function addToShoppingList() {
		var name = document.getElementById('productName').value;
		var quantity = document.getElementById('productQuantity').value;
		var price = document.getElementById('productPrice').value;
		var category = document.getElementById('productCategory').value;
		var store = document.getElementById('productStore').value;

		var product = {
			name : name,
			quantity : quantity,
			price : price,
			category : category,
			store : store
		};
		shoppingList.push(product);
		addToSheets(shoppingListSheetName, product);
		loadShoppingList();
	}

	function addToSheets(sheetName, product) {
		gapi.client.sheets.spreadsheets.values
				.append(
						{
							spreadsheetId : spreadsheetId,
							range : sheetName,
							valueInputOption : 'USER_ENTERED',
							insertDataOption : 'INSERT_ROWS',
							resource : {
								values : [ [ product.name, product.quantity,
										product.price, product.category,
										product.store ] ]
							}
						}).then(function(response) {
					console.log('Product added to ' + sheetName);
				}, function(response) {
					console.error('Error adding product to ' + sheetName);
				});
	}

	function loadCategories() {
		var categorySelect = document.getElementById('productCategory');
		categorySelect.innerHTML = '';
		for (var i = 0; i < categories.length; i++) {
			var option = document.createElement('option');
			option.value = categories[i];
			option.text = categories[i];
			categorySelect.appendChild(option);
		}
	}

	function loadStores() {
		var storeSelect = document.getElementById('productStore');
		storeSelect.innerHTML = '';
		for (var i = 0; i < stores.length; i++) {
			var option = document.createElement('option');
			option.value = stores[i];
			option.text = stores[i];
			storeSelect.appendChild(option);
		}
	}

	function loadShoppingList() {
		var shoppingListDiv = document.getElementById('shoppingList');
		shoppingListDiv.innerHTML = '';
		for (var i = 0; i < shoppingList.length; i++) {
			var product = shoppingList[i];
			var p = document.createElement('p');
			p.textContent = 'Name: ' + product.name + ', Quantity: '
					+ product.quantity + ', Price: ' + product.price
					+ ', Category: ' + product.category + ', Store: '
					+ product.store;
			shoppingListDiv.appendChild(p);
		}
	}

	function loadInventoryList() {
		var inventoryListDiv = document.getElementById('inventoryList');
		inventoryListDiv.innerHTML = '';
		for (var i = 0; i < inventoryList.length; i++) {
			var product = inventoryList[i];
			var p = document.createElement('p');
			p.textContent = 'Name: ' + product.name + ', Quantity: '
					+ product.quantity + ', Price: ' + product.price
					+ ', Category: ' + product.category + ', Store: '
					+ product.store;
			inventoryListDiv.appendChild(p);
		}
	}

	function handleRealTimeUpdates(response) {
		var updatedRange = response.result.updatedRange;
		var sheetName = updatedRange.split('!')[0];
		if (sheetName === inventorySheetName) {
			loadInventoryList();
		} else if (sheetName === shoppingListSheetName) {
			loadShoppingList();
		}
	}

	function setupRealTimeUpdates() {
		var params = {
			spreadsheetId : spreadsheetId,
			ranges : [ inventorySheetName, shoppingListSheetName ],
			includeGridData : false
		};
		var request = gapi.client.sheets.spreadsheets.get(params);
		request
				.then(
						function(response) {
							var sheets = response.result.sheets;
							for (var i = 0; i < sheets.length; i++) {
								var sheetId = sheets[i].properties.sheetId;
								gapi.client.sheets.spreadsheets.sheets
										.watch(
												{
													spreadsheetId : spreadsheetId,
													resource : {
														sheetId : sheetId,
														ranges : [
																inventorySheetName,
																shoppingListSheetName ],
														type : 'PUSH',
														address : {
															row : 1,
															column : 1,
															sheetId : sheetId
														}
													}
												})
										.then(
												function(response) {
													console
															.log('Real-time updates enabled for sheet: '
																	+ response.result.sheetId);
												},
												function(response) {
													console
															.error('Error enabling real-time updates for sheet: '
																	+ response.result.sheetId);
												});
							}
						},
						function(response) {
							console
									.error('Error getting spreadsheet information');
						});
	}

	$(document).ready(function() {
		$('#addToShoppingListForm').submit(function(event) {
			event.preventDefault();
			addToShoppingList();
		});
	});
</script>
</head>
<body>
	<h1>Shopping List</h1>

	<form id="addToShoppingListForm">
		<label for="productName">Product Name:</label> <input type="text"
			id="productName" required><br> <label
			for="productQuantity">Quantity:</label> <input type="number"
			id="productQuantity" required><br> <label
			for="productPrice">Price:</label> <input type="number"
			id="productPrice" step="0.01" required><br> <label
			for="productCategory">Category:</label> <select id="productCategory"></select><br>

		<label for="productStore">Store:</label> <select id="productStore"></select><br>

		<button type="submit">Add to Shopping List</button>
	</form>

	<h2>Shopping List</h2>
	<div id="shoppingList"></div>

	<h2>Inventory List</h2>
	<div id="inventoryList"></div>

	<script src="https://apis.google.com/js/api.js?onload=handleClientLoad"></script>
</body>
</html>
